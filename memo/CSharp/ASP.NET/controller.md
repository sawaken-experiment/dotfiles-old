# Controller tips

# ルーティング
App_Start/RouteConfig.csにて定義する。RouteConfig.csはGlobal.asax.csに呼び出される。

p368

# モデルバインド
コントローラのアクションメソッドの引数の型と名前から、パターンマッチのようなことができる。

* int id - "id"という名のオプション/クエリ。
* Member member - ルートパラメータ/クエリがmemberにバインドされる。
* IList<Member> list - ルートパラメータ/クエリがリストとしてバインドされる。参考書p268
* IDictionary<String, Member> list - ルートパラメータ/クエリがディクショナリとしてバインドされる。参考書p271
* HttpPostedFileBase data - ポストされたファイルがバインドされる。Web.configで送信ファイルサイズの規制をかけられる。p272.

## バインド項目の制限
パラメータの属性として設定する。
```csharp
public ActionResult Create([BInd(Include = "Id,Name")] Member member) {}
```

参考書p266

## 何がバインドされるのか

* 親アクションから継承したもの
* ポストデータ
* リクエストJSON
* ルートパラメータ
* クエリー
* アップロードファイル

値プロバイダーが処理してくれる。値プロバイダーの詳細と自作方法はp275

## どうバインドされるのか
値プロバイダーが収集したデータを、モデルバインダーが処理してくれる。モデルバインダーの詳細と自作方法はp278

# ActionResult
アクションメソッドが返すべき値の型。参考書p282.

RSS生成/PDF生成についても載ってる。

# 状態管理

自分で実装するとなるとかなり面倒な状態管理を、フレームワークが良い感じに提供してくれる。参考書p311。

* 単にクッキーを発行
* セッションを利用(管理部分は全てフレームワークがやってくれる。)
* TempDataを利用(次回リクエストまで利用可能なデータの保存場所。管理は全てフレームワークがやってくれる。)

# フィルター属性

アクションメソッド単位あるいはコントローラー単位(あるいはアプリケーション単位)で指定し、リクエストを処理する前(あるいは後)に定型処理を行わせる。p322.

* 認証をかけるp488
* エラー発生時に定型処理を行う(たとえば共通のエラーページを表示する)p326
* キャッシュを有効化するp332
* リクエストパラメータに<>などが含まれていないかチェックする。(デフォルトでON)p336
* CSRF対策をかける(送信ページを表示する際に、formのhidden値/Cookieに乱数的な合言葉を埋め込み、ユーザが送信してきた値にそれらが含まれているかをチェックする)p338
* httpsアクセスの強制p341
* オーバーライド(例えばコントローラで指定したフィルターを、アクションメソッドで無効化できる。もちろん、無効化後に別のフィルターで上書きしてもよい)p341

## フィルタの自作
p342

# セレクター属性

アクションメソッドに対して指定する。どんなリクエストが来たときに呼ばれるアクションメソッドなのかを指示するためのもの。p359

* どのHTTPメソッドに対して呼ばれるかを指定する(HttpPos属性, HttpGet属性, HttpPut属性など. AcceptVerbs属性でも指定できる)
* アクションメソッドではないことを明示する。p361
* アクション名を、メソッド名とは別につける。ActionName属性。p361

## セレクタの自作
p362
