# XSS

## 問題
ブラウザ上にユーザの秘密情報を表示する限り、以下の前提1は必ず成り立ってしまう。
```
前提1 クライアントサイドで動くJSプログラムがユーザの秘密情報にアクセスできる。
```
そこでセキュリティ要件を満たすためには、以下の条件1が満たされる必要がある。
```
条件1 クライアントサイドで動くJSプログラムは、悪意のないプログラムである。
```
当然、被害者が観覧するページに悪意あるJSプログラムを埋め込むことができれば、条件1は満たされない。

## 不正な入力データを保存し公開してしまう
ユーザが入力したデータを保存して公開するようなサービスの場合、
ユーザAが入力した文字列がユーザBのアクセスするページ上に表示される場合がある。
このとき、ユーザAが入力しサーバに保存された文字列が悪意あるJSプログラムならば、
このプログラムはユーザBのブラウザ上で実行されることとなる。

## XSS + フィッシング
保存対象でない入力データについても、ページの表示に利用するならばvalidationを行う必要がある。
たとえば、hoge.comがURLクエリで送られた文字列をそのままページに表示するようなサービスであれば、
下記のようなリンクはフィッシングに利用され得る。
```
http://hoge.com/?text=<悪意あるJSプログラムの文字列>
```

## XSSの対策1
抜本的対策としては、入力データのvalidationを行うに尽きる。
コメント欄などで任意の文字列を入力として受け付ける必要がある場合は、エスケープ処理を施す。

## XSSの対策2
保険的対策としては、JSプログラムがユーザの秘密情報にアクセスし辛くするという手がある。
たとえば、CookieにJSからはアクセスできないようにする等。
